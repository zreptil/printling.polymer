<html><head><link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../google-signin/google-signin.html">
<link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="import.html">
<link rel="import" href="cloud-data-overlay.html">
<!--
`cloud-data` is an element that encapsulates some of the features of googles cloud
data. It uses the element google-signin for the communication with google webservices.

@demo demo/index.html
-->
</head><body><dom-module id="cloud-data">
  <template>
    <style is="custom-style">
      :host
      {
        @apply(--backdrop)
      }
      img
      {
        width: 50px;
      }
      paper-button
      {
        background: #a0a0ff;
      }
      google-signin
      {
        --google-signin-background: var(--paper-light-red-500);
      }
      @media(pointer:coarse)
      {
        body
        {
          background: red;
        }
        paper-button
        {
          font-size: 2em;
          padding: 1.7em 1.57em;
        }
      }
    </style>
    <google-signin id="button" brand="google" client-id="{{googleClientId}}" signed-in="{{_signedIn}}" label-signout="{{googleUserName}}" on-google-signin-success="_handleSignIn" on-google-signed-out="_handleSignOut" scopes="[[_scopes]]" is-authorized="{{_isAuthorized}}" disconnect-on-signout="{{disconnectOnSignout}}" openid-prompt="select_account" <="" google-signin="">
    <cloud-data-overlay id="overlay" no-cancel-on-outside-click="" with-backdrop="" hide-overlay="{{hideOverlay}}"></cloud-data-overlay>
  </google-signin></template>
</dom-module>
<script>var __cloudData=void 0;Polymer({is:"cloud-data",properties:{_isAuthorized:{type:Boolean,value:!1},_signedIn:{type:Boolean,value:!1},_scopes:{type:String,value:""},disconnectOnSignout:{type:Boolean,value:!1},googleClientId:{type:String,value:""},googleSheetsFileId:{type:String,value:""},googleSigninHideSelector:{type:String,value:""},googleSigninShowSelector:{type:String,value:""},googleStatus:{type:String,value:"Not granted"},googleUserEmail:{type:String,value:""},googleUserImg:{type:String,value:""},googleUserName:{type:String,value:"N/A"},isDebug:{type:Boolean,value:!1},hideOverlay:{type:Boolean,value:!1},overlayMsg:{type:String,value:void 0}},ready:function(){this.scDrive="https://www.googleapis.com/auth/drive ",this.scCalendar="https://www.googleapis.com/auth/calendar ",this.scSheets="https://www.googleapis.com/auth/spreadsheets ",this._scopes=this.scDrive+this.scCalendar+this.scSheets,this.handlingSignOut=!1,this.dataPool=[],this.dataRequests=[];try{this.hideControl=document.querySelector(this.googleSigninHideSelector),this.hideControl.removeAttribute("hidden")}catch(e){this.hideControl=void 0}try{this.showControl=document.querySelector(this.googleSigninShowSelector),this.showControl.setAttribute("hidden","")}catch(e){this.showControl=void 0}document.body.appendChild(this.$.overlay)},_callGoogleApi:function(e,t,a,s){return void 0==s&&this.hideOverlay?void setTimeout(this._callGoogleApi(e,t,a,!0),10):gapi.auth?gapi.client?(void 0!=this.overlayMsg&&(e=this.overlayMsg),this.$.overlay.isCanceled||this.$.overlay.show(e),void 0==__cloudData&&(__cloudData={self:this}),void gapi.auth.authorize({client_id:this.googleClientId,scope:this._scopes,immediate:!0,authuser:this._googleAuthUser},function(e){if(e&&!e.error)return void a(e);__cloudData.self.$.overlay.showCancelButton=!0;var t="unknown";e&&(e.error_description?t=e.error_description:e.error&&(t=e.error)),__cloudData.self.$.overlay.text="error when accessing google-api: "+t,__cloudData.self.$.overlay.showCancelButton=!1},function(e){__cloudData.self.$.overlay.text="error when accessing google-api: "+e})):void gapi.load("client",function(){gapi.client?__cloudData.self._callGoogleApi(e,t,a,!0):(alert("Client-API konnte nicht geladen werden."),__cloudData=void 0)}):void gapi.load("auth",function(){gapi.auth?__cloudData.self._callGoogleApi(e,t,a,!0):(alert("Auth-API konnte nicht geladen werden."),__cloudData=void 0)})},_handleSignIn:function(e){this.googleStatus="signin granted",this._googleAuthUser=gapi.auth2.getAuthInstance().currentUser.get().getAuthResponse().session_state.extraQueryParams.authuser,this._googleAuthUser||(this._googleAuthUser="0"),this.googleUserEmail=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getEmail(),this.googleUserName=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getName(),this.googleUserImg=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile().getImageUrl(),this.hideControl&&this.hideControl.setAttribute("hidden",""),this.showControl&&(this.showControl.removeAttribute("hidden"),this.showControl.signinDone&&this.showControl.signinDone(this)),this.fire("status-change")},_handleSignOut:function(e){this._handlingSignOut||(this._handlingSignOut=!0,this.googleUserImg="",this.googleStatus="signed out",this.googleUserName="",this.hideControl&&this.hideControl.removeAttribute("hidden"),this.disconnectOnSignout&&this.disconnect(),this.showControl&&(this.showControl.setAttribute("hidden",""),this.showControl.signoutDone&&this.showControl.signoutDone(this)),this._handlingSignOut=!1,this.fire("status-change"))},_msg:function(e){this.showControl&&this.showControl.msg&&this.showControl.msg(e)},_msgDebug:function(e){this.isDebug&&console.log("[cloud-data] "+e)},disconnect:function(){var e=gapi.auth2.getAuthInstance().currentUser.get();e&&e.disconnect(),gapi.auth2.getAuthInstance().signOut()},signOut:function(){this.$.button.signOut()},_callGoogleCalendarApi:function(e,t,a,s,i){this._callGoogleApi(a,this.scSheets,function(a){gapi.client.load("calendar","v3",function(){s&&s()},function(a){__cloudData.self._apiError(e,t,a,i)})},function(a){__cloudData.self._apiError(e,t,a,i)})},requestCalendarList:function(e,t){return void 0!=__cloudData?void this.dataRequests.push(["requestCalendarList",e,t]):(__cloudData={self:this},void this._callGoogleCalendarApi(e,"requestCalendarList","requesting calendar list...",function(){var a=gapi.client.calendar.calendarList.list({key:""});a.execute(function(a){a.error?(__cloudData.self._endRequest("requestCalendarList"),__cloudData.self._msg("error retrieving calendar list: "+a.message)):(__cloudData.self._endRequest("requestCalendarList"),t&&t(e,a.items))}.bind(this),function(a){__cloudData.self._apiError(e,"requestCalendarList",a,t)})}))},addNotification:function(e,t,a,s,i,o){return a||(a=[]),void 0!=__cloudData?void this.dataRequests.push(["addNotification",e,t,a,s,i,o]):(__cloudData={self:this},void this._callGoogleApi("requesting calendar list...",this.scCalendar,function(a){gapi.client.load("calendar","v3",function(){var a=s.substr(0,4)+"-"+s.substr(4,2)+"-"+s.substr(6,2)+"T"+s.substr(8,2)+":"+s.substr(10,2)+":00",n={summary:i,description:"created by cloud-data",start:{dateTime:a,timeZone:"Europe/Berlin"},end:{dateTime:a,timeZone:"Europe/Berlin"},reminders:{useDefault:!1,overrides:[{method:"popup",minutes:"1"}]}},l=gapi.client.calendar.events.insert({calendarId:t,resource:n});l.execute(function(t){t.error&&__cloudData.self._msg("error when setting the notification: "+t.message),__cloudData.self._endRequest("addNotification"),o&&o(e,new Date(t.start.dateTime))}.bind(this))})}))},_getMetadata:function(e){var t="";if(void 0==e)return t;var a="";for(var s in e)t+=e[s]instanceof Object?a+'\n "'+s+'":{'+this._getMetadata(e[s])+"\n }":a+'\n "'+s+'":"'+e[s]+'"',a=",";return t},saveData:function(e,t,a,s){if(""==a){var i=t._id.lastIndexOf(".");i>=0&&(a=t._id.substr(i+1),t._id=t._id.substr(0,i))}if(void 0!=__cloudData)return void this.dataRequests.push(["saveData",e,t,a,s]);this._msgDebug("saveData("+t._id+"."+a+")");for(var o=!1,n=0;n<this.dataPool.length&&!o;n++)this.dataPool[n]._id==t._id&&(this.dataPool[n]=this.cloneOf(t),o=!0);o||this.dataPool.push(this.cloneOf(t)),__cloudData={self:this,id:t._id},__cloudData.self._msgDebug("saveData: connecting to google-server..."),this._callGoogleApi("saving data...",this.scDrive,function(i){gapi.client.load("drive","v3",function(){var i=__cloudData.self.cloneOf(t);i._modified=void 0,i._fileId=void 0,i._id=void 0,i._ext=void 0;var o;o="json"==a?JSON.stringify(i):i.content;var n=gapi.auth.getToken().access_token,l=new XMLHttpRequest,r="--=#clouddata#=--",d="text/plain";"json"==a&&(d="application/json");var u="--"+r,c='{\n "title":"';if(c+=t._id?t._id:t.name,c.substr(c.length-a.length-1)!="."+a&&(c+="."+a),c+='"',void 0!=i.metadata&&(c+=","+__cloudData.self._getMetadata(i.metadata)),c+="\n}",u+="\nContent-Type: application/json; charset=UTF-8\n\n"+c+"\n\n",u+="--"+r+"\nContent-Type: "+d+"\n\n"+o+"\n",u+="--"+r+"--",i=u,t._fileId){__cloudData.self._msgDebug("saveData: requesting file "+t._id+"."+a+" for modification check...");var n=gapi.auth.getToken().access_token,l=new XMLHttpRequest;return l.open("GET","https://www.googleapis.com/drive/v3/files/"+t._fileId+"?fields=modifiedTime"),l.setRequestHeader("Authorization","Bearer "+n),l.onload=function(){var o=JSON.parse(l.responseText);return t._modified!=o.modifiedTime?t._alreadyModChecked?(__cloudData.self._msgDebug("saveData: file was modified - second check, operation canceled"),__cloudData.self.$.overlay.close(),s&&s(e,"canceled",t),void delete t._alreadyModChecked):(__cloudData.self._msgDebug("saveData: file was modified, "+(s?"sending modified-status to app":"operation canceled")),__cloudData.self.$.overlay.close(),__cloudData=void 0,t._modified=o.modifiedTime,void(s&&s(e,"modified",t))):(__cloudData.self._msgDebug("saveData: file was not modified - saving file"),l=new XMLHttpRequest,l.open("PUT","https://www.googleapis.com/upload/drive/v2/files/"+t._fileId+"?uploadType=multipart"),l.setRequestHeader("Authorization","Bearer "+n),l.setRequestHeader("Content-Type","multipart/related; boundary="+r),l.onload=function(){200==l.status?__cloudData.self._saveResult(l.responseText,e,"ok",s,t,a):(__cloudData.self._msg(__cloudData.self._getError("error in cloud-data.saveData:",JSON.parse(l.response))),__cloudData.self._saveResult(l.responseText,e,l.status,s,t,a))},l.onerror=function(){__cloudData.self._saveResult(l.responseText,e,"error",s,t,a)},void l.send(i))},void l.send()}this.isDebug&&this.$.overlay.show("creating new file..."),l.open("POST","https://www.googleapis.com/upload/drive/v3/files?uploadType=multipart"),l.setRequestHeader("Authorization","Bearer "+n),l.setRequestHeader("Content-Type","multipart/related; boundary="+r),l.onload=function(){200==l.status?__cloudData.self._saveResult(l.responseText,e,"ok",s,t,a):(__cloudData.self._msg(__cloudData.self._getError("error in cloud-data.saveData:",JSON.parse(l.response))),__cloudData.self._saveResult(l.responseText,e,l.status,s,t,a))},l.onerror=function(){__cloudData.self._saveResult(l.responseText,e,"error",s,t,a)},l.send(i)})})},_saveResult:function(e,t,a,s,i,o){try{resp=JSON.parse(e),i._id=__cloudData.id,i._ext=o,i._fileId=resp.id,i._modified=resp.modifiedDate,__cloudData.self.$.overlay.close(),__cloudData=void 0}catch(t){this._msg("_saveResult("+e+","+a+","+__cloudData.id+","+o+")")}s&&s(t,a,i)},cloneOf:function(e){var t;if(null==e||"object"!=typeof e)return e;if(e instanceof Date)return t=new Date,t.setTime(e.getTime()),t;if(e instanceof Array){t=[];for(var a=0,s=e.length;a<s;a++)t[a]=this.cloneOf(e[a]);return t}if(e instanceof Object){t={};for(var i in e)e.hasOwnProperty(i)&&(t[i]=this.cloneOf(e[i]));return t}throw new Error("Unable to copy obj! Its type isn't supported.")},checkModifiedOnServer:function(e,t,a){return void 0!=__cloudData?void this.dataRequests.push(["checkModifiedOnServer",e,t,a]):(__cloudData={self:this,id:t.id},void this._callGoogleApi("",this.scDrive,function(a){gapi.client.load("drive","v3",function(){var a=gapi.auth.getToken().access_token,s=new XMLHttpRequest;s.open("GET","https://www.googleapis.com/drive/v3/files/"+t._fileId+"?fields=modifiedTime"),s.setRequestHeader("Authorization","Bearer "+a),s.onload=function(){__cloudData.self._checkResult(t,ext,s.responseText,e,dataChecked),__cloudData.self._endRequest(t.id)},s.onerror=function(){__cloudData.self._msg(resp.message),__cloudData.self._endRequest(t.id)},s.send()})}))},_checkResult:function(e,t,a,s,i){try{var o=a;"json"==t&&(o=JSON.parse(a)),i&&i(s,e._modified,o.modifiedTime)}catch(t){this._msg("error in cloud-data._checkResult("+e._fileId+","+a+"): "+t),e={_id:__cloudData.id}}},_getError:function(e,t){if(t.data&&t.data.length>0){for(var a=0;a<t.data.length;a++){var s=t.data[a];e+="\n"+a+" - location = "+s[a].location+", type = "+s[a].locationType}e+="\n"}if(t.error&&t.error.errors.length>0){for(var a=0;a<t.error.errors.length;a++){var s=t.error.errors[a];e+="\n"+a+" - location = "+s.message+", reason = "+s.reason}e+="\n"}return e+t.message},requestFileList:function(e,t,a,s,i){return void 0!=__cloudData?void this.dataRequests.push(["requestFileList",e,t,a,s,i]):(void 0==s&&(s="id,name"),s.indexOf("trashed")<0&&(s+=",trashed"),void 0==i&&(i="name contains '"+t+"'"),__cloudData={self:this,id:"filelist"},void this._callGoogleApi("searching files...",this.scDrive,function(t){gapi.client.load("drive","v3",function(){var t=gapi.client.drive.files.list({pageSize:1e3,fields:"nextPageToken,files("+s+")",orderBy:"name",q:i});t.execute(function(t){var s=t.files,i="ok";if(void 0==s)i="error",s=__cloudData.self._getError("error in cloud-data.requestFileList:",t),__cloudData.self._msg(s);else for(var o=0;o<s.length;o++){var n=!s[o].trashed;n||(s.splice(o,1),o--)}a&&a(e,i,s),__cloudData.self._endRequest("requestFileList")})})}))},requestData:function(e,t,a,s,i,o,n){if(""==t){var l=e.lastIndexOf(".");l>=0&&(t=e.substr(l+1),e=e.substr(0,l))}if(void 0!=__cloudData)return void this.dataRequests.push(["requestData",e,t,a,s,i,o]);__cloudData={self:this,id:e};var r=void 0;if(void 0==o||!o)for(var d=0;d<this.dataPool.length&&void 0==r;d++)this.dataPool[d]._id==__cloudData.id&&(r=this.cloneOf(this.dataPool[d]));i||(i="loading data..."),r?(s&&s(a,"ok",r),this._endRequest(e)):this._callGoogleApi(i,this.scDrive,function(i){gapi.client.load("drive","v3",function(){if("@"==e.substr(0,1)){var i=gapi.client.drive.files.get({fileId:e.substr(1),alt:"media",fields:"files(idx,name,trashed)"});return void i.then(function(i){__cloudData.self._requestResult(i,t,a,s,{id:e.substr(1)}),__cloudData.self._endRequest(e)},function(i){__cloudData.self._requestResult(content,t,a,s,{id:e.substr(1)}),__cloudData.self._endRequest(e)})}var o=gapi.client.drive.files.list({pageSize:1e3,fields:"nextPageToken, files(id, name, trashed, modifiedTime)",q:"name='"+__cloudData.id+"."+t+"'"});void 0!=n&&(o.q=n),o.execute(function(i){var o=i.files;if(o&&o.length>0){for(var n=0;n<o.length;n++){var l=o[n];if(l.name.substr(0,__cloudData.id.length)==__cloudData.id&&!l.trashed){var r=gapi.client.drive.files.get({fileId:l.id,alt:"media",fields:"files(idx,name,trashed)"});return void r.then(function(i){__cloudData.self._requestResult(i,t,a,s,l),__cloudData.self._endRequest(e)})}}__cloudData.self._requestResult({body:"{}"},t,a,s,{id:"",modifiedTime:""}),__cloudData.self._endRequest(e)}else o?(__cloudData.self._requestResult({body:"{}"},t,a,s,{id:"",modifiedTime:""}),__cloudData.self._endRequest(e)):(__cloudData.self._msg(i.message),__cloudData.self._endRequest(e))})})})},_endRequest:function(e){__cloudData=void 0;var t=!0;if(this.$.overlay.isCanceled&&(this.dataRequests.splice(0,this.dataRequests.length),this.$.overlay.isCanceled=!1),this.dataRequests.length>0&&(this.dataRequests[0].id==e&&this.dataRequests.splice(0,1),this.dataRequests.length>0)){var a=this.dataRequests[0];switch(this.dataRequests.splice(0,1),t=!1,a[0]){case"requestData":setTimeout(this.requestData(a[1],a[2],a[3],a[4],a[5],a[6]),100);break;case"saveData":setTimeout(this.saveData(a[1],a[2],a[3],a[4]),100);break;case"requestFileList":setTimeout(this.requestFileList(a[1],a[2],a[3],a[4],a[5]),100);break;case"requestCalendarList":setTimeout(this.requestCalendarList(a[1],a[2]),100);break;case"addNotification":setTimeout(this.addNotification(a[1],a[2],a[3],a[4],a[5],a[6]),100);break;case"getBackupFile":setTimeout(this.getBackupFile(a[1],a[2]),100);break;case"_saveZip":setTimeout(this._saveZip(a[1]),100);break;case"loadSheetInfo":setTimeout(this.loadSheetInfo(a[1],a[2]),100);break;case"readSheetData":setTimeout(this.readSheetData(a[1],a[2],a[3]),100);break;case"writeSheetData":setTimeout(this.writeSheetData(a[1],a[2],a[3],a[4]),100);break;case"addSheet":setTimeout(this.addSheet(a[1],a[2],a[3]),100);break;case"copySheet":setTimeout(this.copySheet(a[1],a[2],a[3],a[4]),100);break;case"createSpreadsheet":setTimeout(this.createSpreadsheet(a[1],a[2],a[3]),100)}}t&&this.$.overlay.close()},_requestResult:function(e,t,a,s,i){var o,n="ok";try{o="json"==t?JSON.parse(e.body):{content:e.body}}catch(t){this._msgDebug("_requestResult("+e+","+__cloudData.id+","+i.id+"): "+t.message),o={_id:__cloudData.id},n="error"}for(this.dataPool.push(this.cloneOf(o));this.dataPool.length>10;)this.dataPool.splice(0,1);o._id=__cloudData.id,o._fileId=i.id,o._ext=t,o._modified=i.modifiedTime,s&&s(a,n,o)},_decode:function(e){for(var t=new Uint8Array(e.length),a=0;a<t.length;a++)t[a]=e.charCodeAt(a);return t},_getBackupFiles:function(e,t){t||(__cloudData.self._zip=new JSZip);var a=gapi.client.drive.files.list({pageToken:t,pageSize:100,fields:"nextPageToken,files(id,name,trashed)",orderBy:"name",q:"name contains '"+__cloudData.id+"'"});a.then(function(t){for(var a=0;a<t.result.files.length;a++){if(__cloudData.self.$.overlay.isCanceled)return __cloudData.self._zip=void 0,void __cloudData.self._endRequest("");var s=t.result.files[a];if(!s.trashed){var i="backupfile is being created, please wait ...<br>adding file <b>"+s.name+"</b> hinzu";__cloudData.self.requestData(s.name,"",__cloudData.self,__cloudData.self._packBackupFile,i,!1)}}__cloudData.self.dataRequests.push(["_saveZip",e]),__cloudData.self._endRequest("getBackupFile")})},_packBackupFile:function(e,t,a){if("ok"!=t)return void e._msg("file "+a.id+" could not be packed.");var s=a._id+"."+a._ext;a.content?e._zip.file(s,e._decode(a.content)):e._zip.file(s,JSON.stringify(a))},getBackupFile:function(e,t){return void 0!=__cloudData?void this.dataRequests.push(["getBackupFile",e,t]):void(this.$.overlay.isCanceled||(__cloudData={self:this,id:e},this.$.overlay.showCancelButton=!0,this._callGoogleApi("backupfile is being created...",this.scDrive,function(e){gapi.client.load("drive","v3",function(){__cloudData.self._getBackupFiles(t)})})))},_saveZip:function(e){__cloudData=void 0,this.$.overlay.close();this._zip.generateAsync({type:"blob"}).then(function(t){saveAs(t,e)});this.$.overlay.showCancelButton=!1},_callGoogleSheetsApi:function(e,t,a,s,i){this._callGoogleApi(a,this.scSheets,function(a){gapi.client.load("https://sheets.googleapis.com/$discovery/rest?version=v4").then(function(){s&&s()},function(a){__cloudData.self._apiError(e,t,a,i)})},function(a){__cloudData.self._apiError(e,t,a,i)})},_apiError:function(e,t,a,s){s&&s(e,"error",a.result.error),__cloudData.self._msg(a.result.error.message),__cloudData.self._endRequest(t)},loadSheetInfo:function(e,t){return void 0!=__cloudData?void this.dataRequests.push(["loadSheetInfo",e,t]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"loadSheetInfo","loading Sheetinfo...",function(){var a={spreadsheetId:__cloudData.self.googleSheetsFileId,fields:"sheets.properties"};gapi.client.sheets.spreadsheets.get(a).then(function(a){if(t){for(var s=[],i=0;i<a.result.sheets.length;i++)s.push(a.result.sheets[i].properties);t(e,"ok",s)}__cloudData.self._endRequest("loadSheetInfo")},function(a){__cloudData.self._apiError(e,"loadSheetInfo",a,t)})},t))},readSheetData:function(e,t,a){return void 0!=__cloudData?void this.dataRequests.push(["readSheetData",e,t,a]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"readSheetData","reading range "+t+"...",function(){var s={spreadsheetId:__cloudData.self.googleSheetsFileId,range:t,valueRenderOption:"UNFORMATTED_VALUE"};t.constructor===Array?(delete s.range,s.ranges=t,s.majorDimension="ROWS",gapi.client.sheets.spreadsheets.values.batchGet(s).then(function(s){a&&a(e,"ok",s.result.valueRanges,t),__cloudData.self._endRequest("readSheetData")},function(t){__cloudData.self._apiError(e,"readSheetData",t,a)})):gapi.client.sheets.spreadsheets.values.get(s).then(function(s){a&&a(e,"ok",s.result.values,t),__cloudData.self._endRequest("readSheetData")},function(t){__cloudData.self._apiError(e,"readSheetData",t,a)})},a))},writeSheetData:function(e,t,a,s){return void 0!=__cloudData?void this.dataRequests.push(["writeSheetData",e,t,a,s]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"writeSheetData","writing range "+t+"...",function(){if(""==t||void 0==t){var i={spreadsheetId:__cloudData.self.googleSheetsFileId,requests:a};gapi.client.sheets.spreadsheets.batchUpdate(i).then(function(a){s&&s(e,"ok",a.result,t),__cloudData.self._endRequest("writeSheetData")},function(t){__cloudData.self._apiError(e,"writeSheetData",t,s)})}else{var i={spreadsheetId:__cloudData.self.googleSheetsFileId,majorDimension:"ROWS",range:t,values:a,valueInputOption:"USER_ENTERED"};gapi.client.sheets.spreadsheets.values.update(i).then(function(a){s&&s(e,"ok",a.result,t),__cloudData.self._endRequest("writeSheetData")},function(t){__cloudData.self._apiError(e,"writeSheetData",t,s)})}},s))},addSheet:function(e,t,a){return void 0!=__cloudData?void this.dataRequests.push(["addSheet",e,t,a]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"addSheet","adding sheet "+t+"...",function(){var s={spreadsheetId:__cloudData.self.googleSheetsFileId,requests:[{addSheet:{properties:{title:t}}}]};gapi.client.sheets.spreadsheets.batchUpdate(s).then(function(i){if(a){var o=a(e,"ok",i.result.replies[0].addSheet.properties,t);void 0!=o&&o.constructor===Array?(s.requests=o,gapi.client.sheets.spreadsheets.batchUpdate(s).then(function(e){__cloudData.self._endRequest("addSheet")},function(t){__cloudData.self._apiError(e,"addSheet",t,a)})):__cloudData.self._endRequest("addSheet")}else __cloudData.self._endRequest("addSheet")},function(t){__cloudData.self._apiError(e,"addSheet",t,a)})},a))},createSpreadsheet:function(e,t,a){return void 0!=__cloudData?void this.dataRequests.push(["createSpreadsheet",e,t,a]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"createSpreadsheet","creating spreadsheet "+t+"...",function(){gapi.client.sheets.spreadsheets.create().then(function(s){a&&a(e,"ok",s.result,t),__cloudData.self._endRequest("createSpreadsheet")},function(t){__cloudData.self._apiError(e,"createSpreadsheet",t,onError)})},a))},copySheet:function(e,t,a,s){return void 0!=__cloudData?void this.dataRequests.push(["copySheet",e,t,a,s]):(__cloudData={self:this},void this._callGoogleSheetsApi(e,"copySheet","copying sheet "+t+" to "+name+"...",function(){var i={spreadsheetId:__cloudData.self.googleSheetsFileId,requests:[{duplicateSheet:{sourceSheetId:t,insertSheetIndex:9999,newSheetName:a}}]};gapi.client.sheets.spreadsheets.batchUpdate(i).then(function(a){s&&s(e,"ok",a.result.replies[0].duplicateSheet.properties,t,name),__cloudData.self._endRequest("copySheet")},function(t){__cloudData.self._apiError(e,"copySheet",t,s)})},s))}});</script>
</body></html>